# Home Telemetry

## Quickstart (Windows, local server + DB in Docker)

1. Start everything:
```powershell
cd C:\dev\home-telemetry
copy .env.example .env
# edit .env if needed
.\scripts\dev.ps1
```

2. Open the web UI:
```
http://localhost:5173
```

3. Open Swagger:
```
https://localhost:8443/swagger/index.html
```

## What Starts
- TimescaleDB (Docker)
- Go API server (HTTPS on `:8443`)
- React/Vite web app (HTTP on `:5173`)

## Environment

Required:
- `DATABASE_URL`
- `AUTH_TOKEN`
- `TLS_CERT`
- `TLS_KEY`

Optional:
- `HTTP_ADDR` (default `:8443`)
- `CORS_ORIGINS` (default `*`)

## Web App Notes
- The dev server proxies `/api` to `https://localhost:8443`.
- If your TLS cert is self-signed, your browser must trust it.

## Migrations
```powershell
cd C:\dev\home-telemetry\server
$env:DATABASE_URL="postgres://postgres:postgres@localhost:5432/telemetry?sslmode=disable"
go run .\cmd\migrate
```

## TLS (Dev)
- Certs live in `server\certs`.
- Generated by `server\scripts\gen-cert.ps1`.
- Accept the browser warning or install the cert into Trusted Root.

## Notes
- Swagger requires `Authorization: Bearer <token>`.
## Swagger Generation

`powershell
.\\scripts\\gen-swagger.ps1
`
## Agent (Windows + NVIDIA)

### Prereqs
- NVIDIA drivers + `nvidia-smi` on PATH
- LibreHardwareMonitor (LHM) for CPU temperature
  - Enable LHM web server (default: `http://localhost:8085/data.json`)

### Run (one-off, print only)
```powershell
cd C:\dev\home-telemetry\agent
go run .\cmd\agent --once --print-only --lhm-url http://localhost:8085/data.json
```

### Run (continuous)
```powershell
cd C:\dev\home-telemetry\agent
go run .\cmd\agent --server https://localhost:8443 --token dev-token --interval 5s --lhm-url http://localhost:8085/data.json
```

### Env / Flags
- `SERVER_URL` / `--server`
- `AUTH_TOKEN` / `--token`
- `NODE_ID` / `--node`
- `INTERVAL` / `--interval`
- `LHM_URL` / `--lhm-url` (CPU temp source)
- `--once` (collect once and exit)
- `--print-only` (print payload, do not send)